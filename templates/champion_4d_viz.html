<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Champion 4D Analysis - LoL Item Quiz</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin: 0 0 10px 0;
            color: #333;
        }
        
        .subtitle {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #dee2e6;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #0066cc;
        }
        
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
        
        .viz-container {
            background: #fff;
            border-radius: 15px;
            padding: 20px;
            border: 1px solid #dee2e6;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        
        #champion-viz-canvas {
            width: 100%;
            height: 700px;
            display: block;
            filter: grayscale(10%);
        }
        
        .loading-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            color: #666;
        }
        
        .champion-tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
            display: none;
        }
        
        .instructions {
            margin: 20px 0;
            padding: 15px;
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            border-radius: 5px;
        }
        
        .instructions h3 {
            margin-top: 0;
            color: #1976d2;
        }
        
        .legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .legend-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            border-left: 3px solid #28a745;
        }
        
        .back-link {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 20px;
            background: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 5px;
        }
        
        .back-link:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>âš”ï¸ LoL Champions 4D Analysis</h1>
            <div class="subtitle">æš‡äººã‚²ãƒ¼ãƒãƒ¼ã®ãŸã‚ã®171ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³ãƒãƒƒãƒ”ãƒ³ã‚°</div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number">171</div>
                    <div class="stat-label">ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">4</div>
                    <div class="stat-label">æŒ‡æ¨™åˆ†æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">6</div>
                    <div class="stat-label">ãƒ—ãƒ©ã‚¤ãƒãƒªãƒ­ãƒ¼ãƒ«</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">15.14</div>
                    <div class="stat-label">ãƒ‘ãƒƒãƒãƒãƒ¼ã‚¸ãƒ§ãƒ³</div>
                </div>
            </div>
        </div>
        
        <div class="instructions">
            <h3>ğŸ® æ“ä½œæ–¹æ³•</h3>
            <ul>
                <li><strong>ãƒã‚¦ã‚¹ãƒ‰ãƒ©ãƒƒã‚°</strong>: 3Dè¦–ç‚¹ã‚’å›è»¢</li>
                <li><strong>ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«</strong>: ã‚ºãƒ¼ãƒ ã‚¤ãƒ³/ã‚¢ã‚¦ãƒˆ</li>
                <li><strong>ãƒ›ãƒãƒ¼</strong>: ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³è©³ç´°æƒ…å ±è¡¨ç¤º</li>
                <li><strong>ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯</strong>: ã‚ªãƒ¼ãƒˆãƒ•ã‚£ãƒƒãƒˆ</li>
            </ul>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <strong>ğŸ—ºï¸ åº§æ¨™è»¸</strong><br>
                Xè»¸: âš”ï¸ Attack Power<br>
                Yè»¸: ğŸ”® Magic Power<br>
                Zè»¸: ğŸ›¡ï¸ Defense
            </div>
            <div class="legend-item">
                <strong>ğŸ¨ è‰²æƒ…å ±</strong><br>
                ç´«â†’ç·‘â†’é»„: é›£æ˜“åº¦ãƒ¬ãƒ™ãƒ«<br>
                æš—ã„è‰² = ç°¡å˜<br>
                æ˜ã‚‹ã„è‰² = å›°é›£
            </div>
            <div class="legend-item">
                <strong>ğŸ“Š ç™ºè¦‹ãƒã‚¤ãƒ³ãƒˆ</strong><br>
                â€¢ ã‚¿ãƒ³ã‚¯ã¯é«˜ã„Zè»¸ï¼ˆDefenseï¼‰<br>
                â€¢ ãƒ¡ã‚¤ã‚¸ã¯é«˜ã„Yè»¸ï¼ˆMagicï¼‰<br>
                â€¢ ADCã¯é«˜ã„Xè»¸ï¼ˆAttackï¼‰
            </div>
        </div>
        
        <div class="viz-container">
            <div class="loading-message" id="loading-message">ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
            <canvas id="champion-viz-canvas"></canvas>
            <div class="champion-tooltip" id="champion-tooltip"></div>
        </div>
        
        <div style="text-align: center; margin-top: 30px; color: #666;">
            <p>ğŸ“Š Data Source: Riot Games Data Dragon API | ğŸ® For Educational Purpose Only</p>
        </div>
        
        <a href="/etc" class="back-link">â† etcãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
    </div>
    
    <script>
        // Three.js scene setup
        let scene, camera, renderer, controls;
        let championMeshes = [];
        let raycaster, mouse;
        const tooltip = document.getElementById('champion-tooltip');
        
        function initThreeJS() {
            // Scene setup
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xf0f0f0);
            
            // Camera setup - ã‚ˆã‚Šè¿‘ã„ä½ç½®ã§ã‚ºãƒ¼ãƒ çŠ¶æ…‹ã‹ã‚‰é–‹å§‹
            camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
            camera.position.set(8, 8, 8);
            
            // Renderer setup with performance optimizations
            const canvas = document.getElementById('champion-viz-canvas');
            renderer = new THREE.WebGLRenderer({ 
                canvas: canvas, 
                antialias: true,
                alpha: false,           // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š
                powerPreference: "high-performance"
            });
            renderer.setSize(canvas.clientWidth, canvas.clientHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); // é«˜è§£åƒåº¦ãƒ‡ãƒã‚¤ã‚¹ã§ã®è² è·è»½æ¸›
            
            // Controls setup
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            
            // Raycaster for mouse interactions
            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();
            
            // Grid helper - å‰Šé™¤ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼è¦æœ›ï¼‰
            // const gridHelper = new THREE.GridHelper(20, 20, 0x444444, 0x888888);
            // scene.add(gridHelper);
            
            // Axis helper - è§’ã«é…ç½®ï¼ˆé‚ªé­”ã«ãªã‚‰ãªã„ä½ç½®ï¼‰
            const axesHelper = new THREE.AxesHelper(3);
            axesHelper.position.set(-8, -8, -8); // å·¦ä¸‹è§’ã«ç§»å‹•
            scene.add(axesHelper);
            
            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.4);
            directionalLight.position.set(10, 10, 5);
            scene.add(directionalLight);
            
            // Mouse event listeners
            canvas.addEventListener('mousemove', onMouseMove, false);
            canvas.addEventListener('mouseout', onMouseOut, false);
            
            // Window resize handler
            window.addEventListener('resize', onWindowResize, false);
        }
        
        function createChampionMesh(champion) {
            // Create smaller plane geometry for performance
            const geometry = new THREE.PlaneGeometry(0.6, 0.6);
            
            // Load champion texture with optimizations
            const textureLoader = new THREE.TextureLoader();
            
            // Try multiple image sources for optimization
            const imageUrls = [
                // å°ã•ã„ã‚µã‚¤ã‚ºã®ç”»åƒã‚’å„ªå…ˆ
                `https://ddragon.leagueoflegends.com/cdn/15.14.1/img/champion/${champion.key}.png`,
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨
                `https://ddragon.leagueoflegends.com/cdn/img/champion/tiles/${champion.key}_0.jpg`
            ];
            
            const texture = textureLoader.load(
                imageUrls[0],
                function(loadedTexture) {
                    // ç”»åƒèª­ã¿è¾¼ã¿æˆåŠŸæ™‚ã®æœ€é©åŒ–
                    loadedTexture.minFilter = THREE.LinearFilter;
                    loadedTexture.magFilter = THREE.LinearFilter;
                    loadedTexture.generateMipmaps = false; // ãƒŸãƒƒãƒ—ãƒãƒƒãƒ—ç„¡åŠ¹åŒ–ã§è»½é‡åŒ–
                    loadedTexture.format = THREE.RGBFormat; // ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡å‰Šæ¸›
                    loadedTexture.wrapS = THREE.ClampToEdgeWrapping;
                    loadedTexture.wrapT = THREE.ClampToEdgeWrapping;
                },
                undefined,
                function(error) {
                    console.warn(`Failed to load texture for ${champion.name}:`, error);
                    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”»åƒã‚’è©¦ã™
                    const fallbackTexture = textureLoader.load(
                        imageUrls[1],
                        function(fallbackLoaded) {
                            fallbackLoaded.minFilter = THREE.LinearFilter;
                            fallbackLoaded.magFilter = THREE.LinearFilter;
                            fallbackLoaded.generateMipmaps = false;
                            fallbackLoaded.format = THREE.RGBFormat;
                        }
                    );
                    material.map = fallbackTexture;
                    material.needsUpdate = true;
                }
            );
            
            // Create material with difficulty-based color tinting - ã‚ˆã‚Šé®®æ˜ã«
            const difficultyColor = new THREE.Color();
            difficultyColor.setHSL(
                (1 - champion.difficulty / 10) * 0.33, // Hue: ç·‘(0.33) â†’ èµ¤(0)
                0.8,  // Saturation: ã‚ˆã‚Šé®®ã‚„ã‹ã«
                0.7   // Lightness: å°‘ã—æš—ã‚ã§è¦‹ã‚„ã™ã
            );
            
            const material = new THREE.MeshBasicMaterial({
                map: texture,
                transparent: false,  // é€æ˜åº¦å‰Šé™¤ã§è‰²ã‚’é®®æ˜ã«
                color: difficultyColor
            });
            
            // Create mesh
            const mesh = new THREE.Mesh(geometry, material);
            
            // Position based on champion stats (scaled for better visualization)
            mesh.position.set(
                champion.attack - 5,     // Center around 0
                champion.defense - 5,    // Y = Defense (height)
                champion.magic - 5       // Z = Magic
            );
            
            // Store champion data in mesh for interactions
            mesh.userData = champion;
            
            // Make plane always face camera
            mesh.lookAt(camera.position);
            
            return mesh;
        }
        
        function onMouseMove(event) {
            const canvas = document.getElementById('champion-viz-canvas');
            const rect = canvas.getBoundingClientRect();
            
            mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
            mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;
            
            // Raycast to find intersected objects
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(championMeshes);
            
            if (intersects.length > 0) {
                const champion = intersects[0].object.userData;
                showTooltip(event.clientX, event.clientY, champion);
            } else {
                hideTooltip();
            }
        }
        
        function onMouseOut() {
            hideTooltip();
        }
        
        function showTooltip(x, y, champion) {
            tooltip.style.display = 'block';
            tooltip.style.left = (x + 10) + 'px';
            tooltip.style.top = (y - 10) + 'px';
            
            tooltip.innerHTML = `
                <strong>${champion.name}</strong><br>
                <em>${champion.title}</em><br>
                Role: ${champion.tags[0] || 'Unknown'}<br>
                âš”ï¸ Attack: ${champion.attack}<br>
                ğŸ”® Magic: ${champion.magic}<br>
                ğŸ›¡ï¸ Defense: ${champion.defense}<br>
                ğŸ“Š Difficulty: ${champion.difficulty}
            `;
        }
        
        function hideTooltip() {
            tooltip.style.display = 'none';
        }
        
        function onWindowResize() {
            const canvas = document.getElementById('champion-viz-canvas');
            camera.aspect = canvas.clientWidth / canvas.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(canvas.clientWidth, canvas.clientHeight);
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            // Update controls
            controls.update();
            
            // Make all champion planes face the camera
            championMeshes.forEach(mesh => {
                mesh.lookAt(camera.position);
            });
            
            renderer.render(scene, camera);
        }
        
        // Champion data fetch and visualization
        fetch('https://ddragon.leagueoflegends.com/cdn/15.14.1/data/en_US/championFull.json')
            .then(response => response.json())
            .then(data => {
                const champions = [];
                
                for (const [key, champion] of Object.entries(data.data)) {
                    champions.push({
                        key: key,
                        name: champion.name,
                        title: champion.title,
                        attack: champion.info.attack,
                        defense: champion.info.defense,
                        magic: champion.info.magic,
                        difficulty: champion.info.difficulty,
                        tags: champion.tags
                    });
                }
                
                // Hide loading message
                document.getElementById('loading-message').style.display = 'none';
                
                // Initialize Three.js
                initThreeJS();
                
                // Create champion meshes
                champions.forEach(champion => {
                    const mesh = createChampionMesh(champion);
                    championMeshes.push(mesh);
                    scene.add(mesh);
                });
                
                // Start animation loop
                animate();
            })
            .catch(error => {
                console.error('Error fetching champion data:', error);
                document.getElementById('loading-message').innerHTML = 
                    'ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚';
            });
    </script>
</body>
</html>