<!DOCTYPE html>
<html>
<head>
    <title>クイズA 出題アルゴリズム解説 - League of Legends Item Quiz</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <style>
        .algorithm-container {
            max-width: 800px;
            margin: 40px auto;
            padding: 40px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .algorithm-section {
            margin-bottom: 30px;
        }
        .algorithm-section h2 {
            color: #0596aa;
            margin-bottom: 15px;
            border-bottom: 2px solid #0596aa;
            padding-bottom: 10px;
        }
        .algorithm-section h3 {
            color: #333;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        .example-box {
            background: #f0f9ff;
            border: 1px solid #0596aa;
            border-radius: 5px;
            padding: 20px;
            margin: 20px 0;
        }
        .example-box h4 {
            color: #0596aa;
            margin-bottom: 10px;
        }
        .item-example {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }
        .item-example img {
            width: 40px;
            height: 40px;
            margin-right: 10px;
        }
        .code-block {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 14px;
        }
        .flowchart {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        .step {
            background: #0596aa;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            margin: 10px auto;
            display: inline-block;
        }
        .arrow {
            font-size: 24px;
            color: #0596aa;
            margin: 10px 0;
        }
        ul {
            margin-left: 20px;
            line-height: 1.8;
        }
        .back-link {
            display: inline-block;
            background: #0596aa;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 5px;
            margin-top: 30px;
        }
        .back-link:hover {
            background: #047a8a;
        }
    </style>
</head>
<body>
    <div class="algorithm-container">
        <h1>クイズA 出題アルゴリズム解説</h1>
        
        <div class="algorithm-section">
            <h2>概要</h2>
            <p>クイズAは「表示されたアイテムに関連するアイテムをすべて選択する」クイズです。<br>
            プレイヤーは、提示されたアイテムの素材アイテム、または逆にそのアイテムを素材として使用する合成先アイテムを、10個の選択肢の中から見つけ出す必要があります。</p>
        </div>

        <div class="algorithm-section">
            <h2>出題フロー</h2>
            <div class="flowchart">
                <div class="step">1. アイテムデータ取得</div>
                <div class="arrow">↓</div>
                <div class="step">2. フィルタリング処理</div>
                <div class="arrow">↓</div>
                <div class="step">3. アイテムツリー構築</div>
                <div class="arrow">↓</div>
                <div class="step">4. 大きなツリーを持つアイテム選択</div>
                <div class="arrow">↓</div>
                <div class="step">5. 拡張ファミリーから選択肢生成</div>
                <div class="arrow">↓</div>
                <div class="step">6. クイズ出題</div>
            </div>
        </div>

        <div class="algorithm-section">
            <h2>詳細アルゴリズム</h2>
            
            <h3>1. フィルタリング条件</h3>
            <ul>
                <li>サモナーズリフト（マップ11）で使用可能なアイテム</li>
                <li>消耗品、トリンケット、ブーツ、ジャングル、レーン専用アイテムを除外</li>
                <li>ロングソードなどの基本アイテムを除外</li>
                <li>オルン専用アイテムを除外</li>
                <li>特定の除外IDリスト（6693, 6673, 4641, 4637, 1516-1519）に含まれないもの</li>
            </ul>

            <h3>2. 大きなツリーの定義</h3>
            <p>アイテムツリー内のアイテム数が5個以上のものを「大きなツリー」として選択対象とします。</p>

            <h3>3. 拡張ファミリーアルゴリズム</h3>
            <p>選択肢を生成するために「拡張ファミリー」という概念を使用します：</p>
            <ul>
                <li>直接の親アイテム（素材）と子アイテム（派生アイテム）</li>
                <li>その親子アイテムのさらなる親子アイテム（2階層目）</li>
                <li>さらにその親子アイテム（3階層目）</li>
                <li>500ゴールド以上のアイテムのみを選択肢として採用</li>
            </ul>
        </div>

        <div class="algorithm-section">
            <h2>具体例</h2>
            
            <div class="example-box">
                <h4>例1: ジャイアントベルト</h4>
                <div class="item-example">
                    <img src="https://ddragon.leagueoflegends.com/cdn/{{ patch_version }}/img/item/1011.png" alt="ジャイアントベルト">
                    <strong>ジャイアントベルト（900ゴールド）</strong>
                </div>
                
                <p><strong>関連アイテム（正解）：</strong></p>
                <ul>
                    <li>素材アイテム：ルビークリスタル（400ゴールド）</li>
                    <li>合成先アイテム：ウォーモグアーマー、サンファイアイージス、ランデュインオーメン、フローズンマレット等</li>
                </ul>
                
                <p><strong>選択肢の生成過程：</strong></p>
                <ol>
                    <li>直接の関係：
                        <ul>
                            <li>素材：ルビークリスタル</li>
                            <li>合成先：ウォーモグアーマー、サンファイアイージス、ランデュインオーメンなど</li>
                        </ul>
                    </li>
                    <li>拡張ファミリー：
                        <ul>
                            <li>ルビークリスタルを使う他のアイテム：キンドルジェム、ライラインドリークリスタルセプターなど</li>
                            <li>合成先アイテムの他の素材：キンドルジェム、ソーンメイル、バミシンダーなど</li>
                        </ul>
                    </li>
                    <li>500ゴールド以上でフィルタリング後、ランダムに10個選択</li>
                </ol>
                
                <p><strong>選択肢例：</strong><br>
                ウォーモグアーマー（正解）、サンファイアイージス（正解）、ランデュインオーメン（正解）、フローズンマレット（正解）、キンドルジェム、ライラインドリークリスタルセプター、ソーンメイル、バミシンダー、デッドマンプレート、ガーゴイルストーンプレート</p>
            </div>

            <div class="example-box">
                <h4>例2: フェアリーチャーム</h4>
                <div class="item-example">
                    <img src="https://ddragon.leagueoflegends.com/cdn/{{ patch_version }}/img/item/1004.png" alt="フェアリーチャーム">
                    <strong>フェアリーチャーム（250ゴールド）</strong>
                </div>
                
                <p><strong>関連アイテム（正解）：</strong></p>
                <ul>
                    <li>素材アイテム：なし（基本アイテム）</li>
                    <li>合成先アイテム：アーデントセンサー、フォービドンアイドル、ハーモニックエコー、ミカエルのるつぼ等</li>
                </ul>
                
                <p><strong>選択肢の生成過程：</strong></p>
                <ol>
                    <li>直接の関係：
                        <ul>
                            <li>素材：なし（フェアリーチャームは基本アイテム）</li>
                            <li>合成先：アーデントセンサー、フォービドンアイドル、ハーモニックエコー、ミカエルのるつぼなど</li>
                        </ul>
                    </li>
                    <li>拡張ファミリー：
                        <ul>
                            <li>合成先アイテムの他の素材：ブラスティングワンド、サッパイアクリスタル、アンプリファイングトームなど</li>
                            <li>合成先アイテムからさらに合成される上位アイテム：スタッフオブフローイングウォーター等</li>
                        </ul>
                    </li>
                    <li>500ゴールド以上でフィルタリング後、ランダムに10個選択</li>
                </ol>
                
                <p><strong>選択肢例：</strong><br>
                アーデントセンサー（正解）、フォービドンアイドル（正解）、ハーモニックエコー（正解）、ミカエルのるつぼ（正解）、ブラスティングワンド、サッパイアクリスタル、スタッフオブフローイングウォーター、シュレリアのレクイエム、リデンプション、ルーデンテンペスト</p>
            </div>
        </div>

        <div class="algorithm-section">
            <h2>難易度調整の仕組み</h2>
            <ul>
                <li><strong>拡張ファミリーによる選択肢の多様性</strong>：関連アイテムを幅広く含めることで、単純な暗記では対応できない出題を実現</li>
                <li><strong>500ゴールド制限</strong>：基本アイテム（ロングソード等）を除外し、中級以上のアイテムのみを選択肢とすることで適度な難易度を維持</li>
                <li><strong>ランダム性</strong>：同じアイテムでも毎回異なる選択肢が表示され、繰り返しプレイの価値を高める</li>
            </ul>
        </div>

        <div class="algorithm-section">
            <h2>技術的な実装ポイント</h2>
            <div class="code-block">
                # アイテムツリーの構築<br>
                connect_parents(filtered_items, all_trees)<br><br>
                # 大きなツリーの選定（5個以上のアイテムを持つもの）<br>
                large_trees = {item_id: tree for item_id, tree in all_trees.items() <br>
                              if tree and len(get_tree_item_names(tree, all_trees)) >= 5}<br><br>
                # 拡張ファミリーの取得（3階層まで探索）<br>
                extended_family = get_extended_family(item_id, all_trees, all_items)<br><br>
                # 500ゴールド以上でフィルタリング<br>
                extended_family = [family_id for family_id in extended_family <br>
                                  if items[family_id]['gold']['total'] >= 500]
            </div>
        </div>

        <a href="/" class="back-link">メインページに戻る</a>
    </div>
</body>
<footer>
    <p>&copy; 2024 LoL Item Quiz. All rights reserved.</p>
</footer>
</html>